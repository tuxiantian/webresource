---
typora-root-url: ..
---

[TOC]

# Git删除暂存区或版本库中的文件

## 0 基础
我们知道Git有三大区（工作区、暂存区、版本库）以及几个状态（untracked、unstaged、uncommited），下面只是简述下Git的大概工作流程，详细的可以参见本博客的其他有关Git的文章。  
　　（1）打开你的项目文件夹，除了隐藏的.git文件夹，其他项目文件位于的地方便是工作区，工作区的文件需要添加到Git的暂存区（git add），随后再提交到Git的版本库（git commit）。  
　　（2）首次新建的文件都是untracked状态（未跟踪），此时需要git add到暂存区，Git便会在暂存区中生成一个该文件的索引，文件此时处于uncommited状态，需要git commit生成版本库。添加到了版本库之后，再对文件进行修改，那么文件的状态会变为unstaged状态。  
    简单的认识了Git的工作流程，接下来便可以看看如何删除错误添加到暂存区或版本库里的文件了！

## 1 删除错误添加到暂存区的文件
有时你在工作区新建了文件TestFile，并且已经将它添加到了暂存区，git会告知，现有有一个文件未提交到版本库，如下图：

![](/images/git/Git删除暂存区或版本库中的文件/1.png)


### 1.1 仅仅删除暂存区里的文件    
此时你想撤销错误添加到暂存区里的文件，可以输入以下命令：
git rm --cache 文件名

![](/images/git/Git删除暂存区或版本库中的文件/2.png)
​    
上面的命令仅仅删除暂存区的文件而已，不会影响工作区的文件，如上图，TestFile.txt仍然存在，此时输入下面命令，git会告知有一个未跟踪的文件TestFile.txt。  
git status



### 1.2 删除暂存区和工作区的文件
git rm -f 文件名

工作区的文件也被删除了。

![](/images/git/Git删除暂存区或版本库中的文件/3.png) 

## 2 删除错误提交的commit
有时，不仅添加到了暂存区，而且commit到了版本库，这个时候就不能使用git rm了，需要使用git reset命令。  错误提交到了版本库，此时无论工作区、暂存区，还是版本库，这三者的内容都是一样的，所以在这种情况下，只是删除了工作区和暂存区的文件，下一次用该版本库回滚那个误添加的文件还会重新生成。  
这个时候，我们必须撤销版本库的修改才能解决问题！  
git reset有三个选项，--hard、--mixed、--soft。  

* 仅仅只是撤销已提交的版本库，不会修改暂存区和工作区 git reset --soft 版本库ID  

* 仅仅只是撤销已提交的版本库和暂存区，不会修改工作区 git reset --mixed 版本库ID

* 彻底将工作区、暂存区和版本库记录恢复到指定的版本库 git reset --hard 版本库ID  

    那我们到底应该用哪个选项好呢？  
    （1）如果你是在提交了后，对工作区的代码做了修改，并且想保留这些修改，那么可以使用git reset --mixed 版本库ID，注意这个版本库ID应该不是你刚刚提交的版本库ID，而是刚刚提交版本库的上一个版本库。
    （2）如果不想保留这些修改，可以直接使用彻底的恢复命令，git reset --hard 版本库ID。  
    （3）为什么不使用--soft呢，因为它只是恢复了版本库，暂存区仍然存在你错误提交的文件索引，还需要进一步使用上一节的删除错误添加到暂存区的文件，详细见上文。  
    

## 3 git commit --amend

amend翻译成中文具有修改和改良的意思。

git commit --amend具有修改最后一次commit提交的功能。

**一.修改最后一次commit提交信息：**

commit提交信息是对此次提交的简略描述，便于团队开发和后期维护。

如果对最后一次提交信息不满意，可以利用git commit --amend对其进行修改。

首先看一下提交历史：

```
$ git log --oneline
```

提交历史截图如下：

![a:3:{s:3:\"pic\";s:43:\"portal/201807/14/112212rkwakkv4aqq12k1a.jpg\";s:5:\"thumb\";s:0:\"\";s:6:\"remote\";N;}](http://www.softwhy.com/data/attachment/portal/201807/14/112212rkwakkv4aqq12k1a.jpg)

最后一次提交有失误，应该是"c3"而不是"c"，修改如下：

```
$ git commit --amend -m "c3"
```

通过上述代码，可以将最后一次提交的描述信息修改为"c3"。

由于提交信息改变，那么此次提交的SHA-1值也会改变。

**二.修改最后一次提交的文件：**

实际应用中，当完成一次提交之后，可能会发现此次提交有些文件需要修改，当然我们可以在下一次提交中修改此文件，但这无疑会让提交历史比较累赘。下面就以添加一个新的文件为例子做一下介绍。

首先看一下状态：

![a:3:{s:3:\"pic\";s:43:\"portal/201807/14/112305sqynup6ukos6npn3.jpg\";s:5:\"thumb\";s:0:\"\";s:6:\"remote\";N;}](http://www.softwhy.com/data/attachment/portal/201807/14/112305sqynup6ukos6npn3.jpg)

新增ant.txt文件，当前是未跟踪状态，首先将其加入到暂存区：

```
$ git add ant.txt
```

然后将其进行commit提交即可，代码如下：

```
$ git commit --amend --no-edit
```

这样就可以在最后一次提交中追加一个新的文件。

--no-edit表示最后一次提交信息"c3"没必要修改，保持原样即可。

如果需要修改，采用如下命令:

```
$ git commit --amend -m "add new file"
```

上述代码将commit提交的描述信息修改为"add new file"。