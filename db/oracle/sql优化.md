 优化前

```sql
SELECT C.CRM_ITEM_ID         ITEM_CRM_ITEM_ID,
        C.CUST_ORDER_ITEM_ID  ITEM_CUST_ORDER_ITEM_ID,
        C.SERVICE_OFFER_ID    ITEM_SERVICE_OFFER_ID,
        C.SERVICE_OFFER_NAME  ITEM_SERVICE_OFFER_NAME,
        C.APPLY_OBJ_SPEC      ITEM_APPLY_OBJ_SPEC,
        C.APPLY_OBJ_SPEC_NAME ITEM_APPLY_OBJ_SPEC_NAME,
        C.CREATE_DATE         ITEM_CREATE_DATE,
        D.CUST_ORDER_ID,
        D.CUST_ORDER_CODE,
        D.CUST_ORDER_NBR,
        D.CUST_ID,
        D.CUST_NAME,
        D.ORDER_SOURCE        CUST_ORDER_SOURCE,
        D.ACCEPT_REGION_ID    CUST_ACCEPT_REGION_ID,
        D.VER_NUM             CUST_VER_NUM,
        D.CREATE_STAFF        CUST_CREATE_STAFF,
        D.CREATE_STAFF_NAME   CUST_CREATE_STAFF_NAME,
        D.CREATE_ORG_ID       CUST_CREATE_ORG_ID,
        D.CREATE_ORG_NAME     CUST_CREATE_ORG_NAME,
        D.SYS_SOURCE          CUST_SYS_SOURCE,
        D.CRM_CREATE_DATE     CUST_CRM_CREATE_DATE,
        D.CREATE_DATE         CUST_CREATE_DATE,
        D.RAW_JSON            CUST_RAW_JSON,
        D.MSG_ID              CUST_MSG_ID,
        lc.REQ_DATA           CUST_IN_DATA,
        A.SERVICE_ORDER_ID,
        A.MAIN_PROD_CODE      SERVICE_PROD_CODE,
        A.MAIN_PROD_NAME      SERVICE_PROD_NAME,
        A.MAIN_PROD_INST_ID   SERVICE_PROD_INST_ID,
        A.TITLE               SERVICE_ORDER_TITLE,
        A.STATE               SERVICE_ORDER_STATE,
        A.CREATE_DATE         SERVICE_CREATE_DATE,
        A.STATE_DATE          SERVICE_STATE_DATE,
        A.REMARK              SERVICE_REMARK,
        A.ERR_CODE            SERVICE_ERR_CODE,
        A.EVENT_ID            SERVICE_EVENT_ID,
        A.DEAL_TIMES          SERVICE_DEAL_TIMES,
        A.LOCK_BY             SERVICE_LOCK_BY,
        A.IOM_DATA            SERVICE_IOM_DATA,
        P.ACC_NUM             SERVICE_ACC_NUM
   FROM SRV_ORDER A
   left JOIN SORDER_CITEM_RELA B
     ON A.SERVICE_ORDER_ID = B.SERVICE_ORDER_ID
   left JOIN CUST_ORDER_ITEM C
     ON B.CUST_ORDER_ITEM_ID = C.CUST_ORDER_ITEM_ID
   left JOIN CUST_ORDER D
     ON D.CUST_ORDER_ID = C.CUST_ORDER_ID
   left JOIN INTF_LOG lc
     on D.MSG_ID = lc.id
    and lc.intf_code = 'DDJS'
   left join (select max(CUST_ORDER_ITEM_ID) CUST_ORDER_ITEM_ID,
                     ACC_NUM,
                     PROD_INST_ID
                from cust_order_prod
               group by PROD_INST_ID, ACC_NUM, CUST_ORDER_ITEM_ID) P
     ON P.CUST_ORDER_ITEM_ID = C.CUST_ORDER_ITEM_ID;
```

   优化后 

```sql
 SELECT C.CRM_ITEM_ID ITEM_CRM_ITEM_ID,
        C.CUST_ORDER_ITEM_ID ITEM_CUST_ORDER_ITEM_ID,
        C.SERVICE_OFFER_ID ITEM_SERVICE_OFFER_ID,
        C.SERVICE_OFFER_NAME ITEM_SERVICE_OFFER_NAME,
        C.APPLY_OBJ_SPEC ITEM_APPLY_OBJ_SPEC,
        C.APPLY_OBJ_SPEC_NAME ITEM_APPLY_OBJ_SPEC_NAME,
        C.CREATE_DATE ITEM_CREATE_DATE,
        D.CUST_ORDER_ID,
        D.CUST_ORDER_CODE,
        D.CUST_ORDER_NBR,
        D.CUST_ID,
        D.CUST_NAME,
        D.ORDER_SOURCE CUST_ORDER_SOURCE,
        D.ACCEPT_REGION_ID CUST_ACCEPT_REGION_ID,
        D.VER_NUM CUST_VER_NUM,
        D.CREATE_STAFF CUST_CREATE_STAFF,
        D.CREATE_STAFF_NAME CUST_CREATE_STAFF_NAME,
        D.CREATE_ORG_ID CUST_CREATE_ORG_ID,
        D.CREATE_ORG_NAME CUST_CREATE_ORG_NAME,
        D.SYS_SOURCE CUST_SYS_SOURCE,
        D.CRM_CREATE_DATE CUST_CRM_CREATE_DATE,
        D.CREATE_DATE CUST_CREATE_DATE,
        D.RAW_JSON CUST_RAW_JSON,
        D.MSG_ID CUST_MSG_ID,
        lc.REQ_DATA CUST_IN_DATA,
        A.SERVICE_ORDER_ID,
        A.MAIN_PROD_CODE SERVICE_PROD_CODE,
        A.MAIN_PROD_NAME SERVICE_PROD_NAME,
        A.MAIN_PROD_INST_ID SERVICE_PROD_INST_ID,
        A.TITLE SERVICE_ORDER_TITLE,
        A.STATE SERVICE_ORDER_STATE,
        A.CREATE_DATE SERVICE_CREATE_DATE,
        A.STATE_DATE SERVICE_STATE_DATE,
        A.REMARK SERVICE_REMARK,
        A.ERR_CODE SERVICE_ERR_CODE,
        A.EVENT_ID SERVICE_EVENT_ID,
        A.DEAL_TIMES SERVICE_DEAL_TIMES,
        A.LOCK_BY SERVICE_LOCK_BY,
        A.IOM_DATA SERVICE_IOM_DATA,
        (SELECT MAX(P.ACC_NUM)
           FROM CUST_ORDER_PROD P
          WHERE P.CUST_ORDER_ITEM_ID = C.CUST_ORDER_ITEM_ID) SERVICE_ACC_NUM
   FROM SRV_ORDER A
   left JOIN SORDER_CITEM_RELA B
     ON A.SERVICE_ORDER_ID = B.SERVICE_ORDER_ID
   left JOIN CUST_ORDER_ITEM C
     ON B.CUST_ORDER_ITEM_ID = C.CUST_ORDER_ITEM_ID
   left JOIN CUST_ORDER D
     ON D.CUST_ORDER_ID = C.CUST_ORDER_ID
   left JOIN INTF_LOG lc
     on D.MSG_ID = lc.id
    and lc.intf_code = 'DDJS';
```


