---
typora-root-url: ..
---

来驾优惠活动模块设计方案
## 一、背景
随着来驾出行项目接近实际运营阶段，通过分析运营团队反馈的实际需求, 结合相关业务的分析发现优惠，促销，打折，套餐，优惠券等等多种营销手段在实际运营过程中非常常见而且很重要，因此，对于运营平台来说必须要能够快速、准确的响应运营管理者的思路并为其提供方便快捷的管理手段。考虑到营销活动内容的多样性，规则的复杂性及很高的时效性这些特点，要求系统能够方便的添加多种活动信息，设置活动规则，包括参与规则和奖励措施，当出现之前用的活动规则应该可以复用，通过简单配置就可完成。
## 二、设计思路
通过分析将营销活动分解为活动基本信息、参与活动规则、奖励措施三个核心环节，然后分别针对三个环节来考虑具体设计方案。  
其中活动基本信息相对比较简单，包含活动名称、有效期范围、执行状态、活动图片、描述等信息；  
参与规则是比较复杂的，营销活动的多样性也主要体现在这部分，思路为将参与规则与活动本身一对多关联，每个参与规则相对独立，可以应用于多个活动，这样既实现规则的复用，又能针对每个规则进行独立的业务实现，便于代码的维护管理；活动规则进一步抽象为规则编码、规则名称、规则配置参数、规则验证参数，配置参数用于管理者在设置规则的时候需要确定的，比如‘前100名方可参与活动’这个规则中100即为配置参数；验证参数是具体在实现规则的业务逻辑时需要用到的参数，比如上述规则在实现时需要‘活动Id’,这样就可以通过查询对应的活动已经参与的人数，来验证当前参与者是否符合该规则。  
奖励措施对于活动来说也非常重要，而且形式多样，思路为将奖励措施分为奖励类型和奖励明细来考虑，奖励类型是‘套餐’，‘次卡’，‘优惠券’，或者‘现金’，‘积分’等这个可以根据业务需要随时来扩充，奖励明细是来描述某种奖励类型的实际奖励信息，比如: 奖励类型是‘次卡’的，奖励明细中要标明是哪种次卡，多少张等。奖励明细与类型配套维护。  
通过以上三个活动核心环节的设计基本可以管理一个新活动所有内容了，下面需要解决的是活动配置好之后，参与流程是怎么样的？首先，在系统中潜在活动参与节点都可以触发一个事件，该事件与一个活动规则关联，然后，在该事件中通过与之关联的规则搜索与规则相关的活动，获取活动包含的所有规则，当该活动的所有规则都验证通过时，当前用户即可参与活动，最后，按活动设置的奖励措施，生成对应的奖励信息。
## 三、方案介绍
### 3.1数据结构
![](/images/work/activity/1.png)  

### 3.2活动生成流程
![](/images/work/activity/2.png)  
### 3.3活动参与流程
![](/images/work/activity/3.png)  
## 四、应用实例
下面用一个具体活动需求来模拟整个活动配置和参与流程。
### 4.1活动描述:
10元/30分钟次卡，买100张送100张，仅限前100名，临朐县有效，欢迎抢购！
### 4.2活动配置：
1. 增加活动基本信息
主要字段：活动名称、活动描述、开始时间、截至时间、活动图片、是否主页宣传、状态
相关数据表：活动信息表
2. 设置活动规则
  	增加 规则名称：需购买次卡，设置参数：次卡ID(10元/30分钟次卡，临朐县), 张数: 100
增加 规则名称：前N名有效，设置参数：N=100
相关数据表：活动规则表、活动规则参数表
3. 奖励设置
增加奖励明细  1）类型：次卡  
奖励次卡信息：次卡ID(10元/30分钟次卡), 奖励张数：100  
相关数据表：活动奖励明细表、活动次卡奖励信息  
### 4.3活动参与
1. 在购买次卡接口完成时触发‘购买次卡’事件
2. 在事件中获取与‘购买次卡’规则相关的活动，得到上述活动
3. 获取该活动所有的规则，得到以上2条规则
4. 逐条进行验证  
		需购买次卡：当前购买的次卡ID,与规则设置参数中的次卡ID比对。  
		前N名有效: 通过活动ID查询该活动当前参与人数，与规则设置参数中的N比对。  
5. 两条规则验证都通过，则该客户符合参与当前活动的要求
6. 获取活动奖励信息  
		获取到一种奖励，类型是次卡  
		在次卡奖励信息表中通过活动ID获取到奖励的次卡ID,和张数  
		在会员次卡信息表中插入相应的数据  
## 五、总结
通过以上设计基本可以解决活动的灵活配置，活动规则的复用，由于活动规则的验证是相对独立的模块，因此，活动规则库的增减对整个活动的配合和参与流程没有大的影响，保证了整体流程的统一流畅。随着运营的不断深入，活动规则库会不断扩充，今后策划新的营销活动，对程序代码影响会越来越小，最终达到不用升级程序即可配置出各种活动要求。  
方案的关键一是活动规则的提炼，每个规则应该具有不可拆分性，这样能最大限度的达到复用效果，二是对每项规则验证参数要求比较严谨，验证参数的不足或相互冲突将直接影响规则的验证结果。  
不足之处，活动规则之间的关系目前默认是‘与’操作，即满足所有规则才能参加活动，而且实际有可能规则之间存在‘排他’、‘并存’、‘择优匹配’等关系，今后根据需要可以考虑进行升级，目前已经满足需求；另外，活动配置的操作界面比较复杂，主要体现在增加不同规则，需要设置不同的参数，奖励不同类型，需要设置不同类型的奖励信息，这方面还不是非常成熟，时间紧迫，之后会在活动配置的操作方便性方面多下功夫。  
最后，设计方案还需要在实际应用中发现不足，不断完善！  
