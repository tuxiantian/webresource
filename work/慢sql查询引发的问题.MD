财务人员登陆系统使用保证金统计功能，由于这是一个慢sql查询，功能比较复杂，查询一次会耗时12秒左右。

![TIM截图20180804113451](D:\webresource\images\work\慢sql查询引发的问题\TIM截图20180804113451.png)

![TIM截图20180804105829](D:\webresource\images\work\慢sql查询引发的问题\TIM截图20180804105829.png)

多次查询占用了数据库连接，数据库连接耗尽，ads数据库CPU占有率飙升，App和后台系统的操作都得不到响应，看起来像是服务挂了。我当时就是就以为服务挂了，可是去ecs服务器看服务进程还在，后台服务的日志打印正常。所以一时间我也想不到是怎么回事，之前都没有遇到过。

最快的解决方式就是终止当前那些耗时较长的会话，然后CPU的压力就释放下来了。

事后，我们商量的方案是：

1. 前端增加遮罩层，在数据返回前禁止用户操作。
2. 后端优化慢sql查询语句。

所在，在开发的过程中一定要警惕慢sql。在这点上，阿里云服务提供了服务很友好。下面是它的慢日志明细查询：

![TIM截图20180804115416](D:\webresource\images\work\慢sql查询引发的问题\TIM截图20180804115416.png)

